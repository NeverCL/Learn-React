# 简介

[文档](http://cn.redux.js.org/index.html)

1. 数据总是单向从顶层向下分发的
1. 组件之间的沟通通过提升state：子组件改变父组件state的办法只能是通过onClick触发父组件声明好的回调
1. state越来越复杂：单页应用的发展导致。包括服务器响应、缓存数据、本地生成尚未持久化到服务器的数据，也包括 UI 状态，如激活的路由，被选中的标签，是否显示加载动效或者分页器等等。

## 安装

`npm i -S redux react-redux redux-devtools`

## 概念

Action：通知Reducer：Action 就是一个普通 JavaScript 对象。如：`{ type: 'ADD_TODO', text: 'Go to swimming pool' }`
Reducer：修改state：接收 state 和 action，并返回新的 state 的函数。(state可设置初始默认值) `(previousState, action) => newState`
Store：连接器：整个应用的 state 被储存在一棵 object tree 中，并且这个 object tree 只存在于唯一一个 store 中。`createStore(reducer)`

reducer注意：

1. Object.assign() : 创建一个副本:`Object.assign({},state, { visibilityFilter: action.filter })`(第一个参数不能为state) 等价于ES7的 `{ ...state, ...newState }`
1. 在 default 情况下返回旧的 state。

combineReducers可合并reducer

`const todoApp = combineReducers({  visibilityFilter, todos })` 等价于 `const todoApp = combineReducers({ visibilityFilter: visibilityFilter(state.visibilityFilter), todos:todos(state.todos) })`

```js
import { combineReducers } from 'redux'
import * as reducers from './reducers'

const todoApp = combineReducers(reducers)
```

## 结合React

组件分为`展示组件` 和 `容器组件`

### 展示组件

描述如何展示：负责UI样式的展示

1. 数据来源：props
1. 数据修改：通过props的回调函数
1. 不直接使用redux

### 容器组件

描述如何运行：负责数据获取 和 状态更新

1. 数据来源：redux state
1. 数据修改：redux 派发action
1. 直接使用redux


import { Provider,connect } from 'react-redux'

Provider：作为顶级组件，让所有容器组件(被connect过的组件)都可以访问 store，而不必显示地传递它。
connect：`connect([mapStateToProps], [mapDispatchToProps], [mergeProps], [options])`

1. `mapStateToProps(state, ownProps) : stateProps`：这个函数允许我们将 store 中的数据作为 props 绑定到组件上。
1. `mapDispatchToProps(dispatch, ownProps): dispatchProps`：这个函数将 action 作为props 绑定到组件上。

当 state 变化，或者 ownProps 变化的时候， mapStateToProps 都会被调用，计算出一个新的 stateProps


```js
import {bindActionCreators} from 'redux';

const mapDispatchToProps = (dispatch, ownProps) => {
  return bindActionCreators({
    increase: action.increase,
    decrease: action.decrease
  });
}
```

## 中间件

redux-thunk、redux-actions

`npm i redux-thunk -S`


通过使用指定的 middleware，action 创建函数除了返回 action 对象外还可以返回函数。

当 action 创建函数返回函数时，这个函数会被 Redux Thunk middleware 执行。这个函数并不需要保持纯净；它还可以带有副作用，包括执行异步 API 请求。